<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Métodos de Encriptación</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/all.css">
    <script src="js/all.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <style>
        body {
            background-image: url("encrypt.png") !important;
            background-repeat: repeat !important;
            background-position: center center !important;
            margin: auto !important;
            background-color: #ed6954;
        }

        footer {
            position: absolute;
            bottom: 0;
            width: 100%;
        }

        .wrapper {
            position: relative !important;
            height: 100vh !important;
        }

        .jumbotron {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }

        .matrixDiv {
            display: grid;
            grid-template-columns: 2fr 2fr 2fr;
            grid-template-rows: 1fr 1fr;
            grid-template-areas: ". . ."". . .";
            margin: auto;
        }

        .matrixDiv input {
            margin: 20px;
            height: 80px;
            width: 80px;
            font-size: 30px;
            text-align: center;
            color: #000000
        }
    </style>
</head>

<body>
    <section class="wrapper" id="pane1">
        <div class="jumbotron" style="width:95%; border: 5px solid #ed69548a; padding-top:25px; padding-bottom:15px;">
            <div class="container">
                <div class="row">
                    <h1>CÓDIGOS LINEALES EN CRIPTOGRAFÍA</h1>
                </div>
                <div class="row">
                    IMPLEMENTACIÓN DE CRIPTOGRAFÍA - ALGEBRA LINEAL II
                </div>
                <div class="row text-center" style="margin-top:50px;">
                    <div class="col-12">
                        <button class="btn btn-lg btn-danger btn-block"
                            id="iniciar"><strong>INICIAR</strong>&nbsp;&nbsp;<i class="fas fa-plus-circle"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="wrapper" id="pane2" style="display:none;">
        <div class="jumbotron"
            style="opacity: 1; width:95%; border: 5px solid #ed69548a; padding-top:25px; padding-bottom:15px;">
            <ul class="nav justify-content-center nav-tabs" style="margin-top:-93px;">
                <li class="nav-item"
                    style="background-color: #e9ecef; border-top: 5px solid #ed69548a; border-left: 5px solid #ed69548a; border-right:5px solid #ed69548a; border-bottom: 5px solid #e9ecef;">
                    <a class="nav-link active"
                        style="background-color: #e9ecef !important; border-bottom: 1px solid #e9ecef;">
                        <h3><strong>CIFRADO DE HILL</strong></h3>
                    </a>
                </li>
            </ul>
            <div class="container" style="max-width: 90%;">
                <!-- Alerta -->
                <div class="row" style="padding-top:15px;">
                    <div class="col-12">
                        <div id="dvAlertaAc" class="alert alert-warning alert-dismissable"
                            style="margin-bottom: 0%;margin-left:0%; margin-right:0%; padding: 0.5% 15px 0.5% 15px">
                            <div class="row" style="display:table!important; width:100%">
                                <div class="col-1"
                                    style="text-align: center!important; float: none; vertical-align:middle;">
                                    <i id="dvAlertaAcIcon" class="fa fa-exclamation-circle" style="font-size: 50px"></i>
                                </div>
                                <div class="col-11"
                                    style="text-align: left!important;float: none; display: table-cell; vertical-align:middle;">
                                    <div id="dvAlertaAcTxt" style="font-size: 14px">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Panel para criptografía -->
                <div class="row" id="divtxtclave" style="padding-top: 20px;">
                    <div class="col-3" style="padding-top:7px; padding-right: 0px;">
                        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                            <div class="btn-group btn-group-lg" role="group" aria-label="First group">
                                <button type="button" class="btn btn-secondary"
                                    id="minus"><strong>[a-z]</strong></button>
                                <button type="button" class="btn btn-secondary"
                                    id="mayus"><strong>[A-Z]</strong></button>
                                <button type="button" class="btn btn-secondary"
                                    id="numeros"><strong>[0-9]</strong></button>
                            </div>
                        </div>
                    </div>
                    <div class="col-9" style="padding-left: 0px;">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-font"
                                        style="font-size:24px;"></i></span>
                            </div>
                            <textarea class="form-control" id="txtAlfabeto" disabled="disabled"
                                aria-label="With textarea"></textarea>
                            <div class="invalid-feedback">
                                Debe de seleccionar al menos un alfabeto para poder continuar.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="divtxtclave2" style="padding-top: 20px;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3"><i class="fas fa-key"
                                    style="font-size:72px;"></i></span>
                        </div>
                        <div class="matrixDiv" style="margin-left:0px;">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                            <input class="form-control onlynumber" max="99" min="0" type="number">
                        </div>
                    </div>
                </div>
                <div class="row text-center" style="padding-top: 20px;">
                    <div class="col-12">
                        <button class="btn btn-success" id="btncontinuar">
                            <strong>CONTINUAR</strong>&nbsp;&nbsp;<i class="fas fa-arrow-circle-right"></i><span
                                class="spinner-border spinner-border-sm" style="display:none;" role="status"
                                aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
                <div class="row" id="divtextodecifrar" style="padding-top: 20px; display:none;">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-font" style="font-size:24px;"></i></span>
                        </div>
                        <textarea class="form-control" id="txtcifrar" aria-label="With textarea"
                            placeholder="Ejemplo: La palabra 'CODIGO'"></textarea>
                        <div class="invalid-feedback">
                            Ingrese el texto que desea codificar para poder continuar.
                        </div>
                    </div>
                    <div class="row text-center" style="padding-top: 20px;">
                        <div class="col-12">
                            <button class="btn btn-primary" id="btnEncriptar">
                                <strong>CODIFICAR</strong>&nbsp;&nbsp;<i class="fas fa-lock"></i><span
                                    class="spinner-border spinner-border-sm" style="display:none;" role="status"
                                    aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row" id="divtextocifrado" style="padding-top: 20px; display:none;">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-lock" style="font-size:24px;"></i></span>
                        </div>
                        <textarea class="form-control" id="txtsalidacifradatexto" disabled="disabled"
                            aria-label="With textarea"></textarea>
                    </div>
                </div>
                <div class="row text-center" id="divdecodificar" style="padding-top: 20px; display:none;">
                    <div class="col-12">
                        <button class="btn btn-warning" id="btnDesencriptar">
                            <strong>DECODIFICAR</strong>&nbsp;&nbsp;<i class="fas fa-unlock"></i><span
                                class="spinner-border spinner-border-sm" style="display:none;" role="status"
                                aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
                <div class="row" id="divtextodescifrado" style="padding-top: 20px; display:none;">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-unlock" style="font-size:24px;"></i></span>
                        </div>
                        <textarea class="form-control" id="txtsalidadescifradatexto" disabled="disabled"
                            aria-label="With textarea"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="bg-white text-black mt-4" style="opacity: 0.8;">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col">© 2019 - (18001167) Manuel Santos - (18002715) Jair Flores - (18001882) Harim
                    Palma</span></div>
                <div class="col"></div>
                <div class="col text-right small align-self-end"></div>
            </div>
        </div>
    </footer>
    <script src="js/math.min.js"></script>
    <script type="text/javascript">
        $("#iniciar").on("click", function () {
            $("#pane2").show(2000);
            $("#pane1").hide('slow');
        });

        /* variables globales */
        var matrizcodificadora = new Array();
        var matrizdecodificadora = new Array();
        var matrizcodificar = new Array();
        var matrizcodificada = new Array();
        var aux = 1;
        var alfabeto = "";

        var n;
        var key = [
            [],
            [],
            []
        ];
        var det;

        function reiniciar() {
            matrizcodificadora = [];
            matrizdecodificadora = [];
            matrizcodificar = [];
            matrizcodificada = [];
            aux = 1;
        }

        function getDeterminent(matrix) {
            let x = matrix[0][0] * ((matrix[1][1] * matrix[2][2]) - (matrix[2][1] * matrix[1][2]));
            let y = matrix[0][1] * ((matrix[1][0] * matrix[2][2]) - (matrix[2][0] * matrix[1][2]));
            let z = matrix[0][2] * ((matrix[1][0] * matrix[2][1]) - (matrix[2][0] * matrix[1][1]));
            return (x - y + z);
        }

        function modularInverse(m, n) {
            let x = m;
            let y = n;

            let divs = [];
            let adds = [];

            let result;

            if (y > x) {
                let i = 1;
                while (x != 0) {
                    divs[i] = Math.floor(y / x);
                    let temp = x;
                    x = y % x;
                    y = temp;
                    i++;
                }

                let len = divs.length;
                adds[len - 1] = 0;
                adds[len - 2] = 1;
                for (let index = len - 2; index > 0; index--) {
                    adds[index - 1] = (divs[index] * adds[index]) + adds[index + 1];
                }

                if ((adds[0] * m) > (adds[1] * n)) {
                    result = adds[0];
                } else {
                    result = n - adds[0];
                }

            }

            return result;

        }

        function inverseMatrix(matrix) {
            let minorMatrix = [
                [0, 0, 0],
                [0, 0, 0],
                [0, 0, 0]
            ];
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {

                    minorMatrix[i][j] = (matrix[(i + 1) % 3][(j + 1) % 3] * matrix[(i + 2) % 3][(j + 2) % 3]) - (matrix[(i + 1) % 3][(j + 2) % 3] * matrix[(i + 2) % 3][(j + 1) % 3]);

                }
            }

            let adjointMatrix = [
                [0, 0, 0],
                [0, 0, 0],
                [0, 0, 0]
            ];
            for (let i = 0; i < minorMatrix.length; i++) {
                for (let j = 0; j < minorMatrix[i].length; j++) {
                    adjointMatrix[j][i] = minorMatrix[i][j];
                }
            }
            return adjointMatrix;
        }

        function multiplyMatrix(a, b) {
            let result = [];
            for (let i = 0; i < a.length; i++) {
                result[i] = 0;
                for (let j = 0; j < a[i].length; j++) {
                    result[i] += b[j] * a[i][j];
                }
            }
            return result;
        }

        function gcd(x, y) {
            x = Math.abs(x);
            y = Math.abs(y);
            while (y) {
                var t = y;
                y = x % y;
                x = t;
            }
            return x;
        }

        function getRidOfNeg(x, n) {
            while (x < 0) {
                x += n;
            }
            return x;
        }

        function alertaAc(msg, clase, icon) {
            $("#dvAlertaAc").removeClass();
            $("#dvAlertaAc").addClass("alert alert-" + clase);
            $("#dvAlertaAcTxt").html(msg);
            $("#dvAlertaAcIcon").removeClass();
            $("#dvAlertaAcIcon").addClass(icon);
            $("#dvAlertaAc").show();
        }
        alertaAc("Seleccione el alfabeto, ingrese la llave y proceda a codificar/decodificar", "warning", "fa fa-exclamation-circle");

        $(".onlynumber").on("keyup", function () {
            this.value = (this.value + '').replace(/[^0-9]/g, '');
            this.value = (this.value > ($("#txtAlfabeto").val()).length) ? ($("#txtAlfabeto").val()).length : this.value;
        });

        $(".onlynumber").on("blur", function () {            
            this.value = (this.value + '').replace(/[^0-9]/g, '');
            this.value = (this.value > 99) ? 99 : this.value;
        });

        $("#txtcifrar").on("keyup", function () {
            if ($("#txtcifrar").val() == "") {
                $("#txtcifrar").addClass("is-invalid");
                $("#txtcifrar").removeClass("is-valid");
            } else {
                $("#txtcifrar").removeClass("is-invalid");
                $("#txtcifrar").addClass("is-valid");
            }
            if (bandera1 == 1 && bandera2 == 1 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^0-9a-zA-Z]/g, '');
            } else if (bandera1 == 1 && bandera2 == 0 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^a-z]/g, '');
            } else if (bandera1 == 0 && bandera2 == 1 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^A-Z]/g, '');
            } else if (bandera1 == 0 && bandera2 == 0 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^0-9]/g, '');
            } else if (bandera1 == 1 && bandera2 == 1 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^a-zA-Z]/g, '');
            } else if (bandera1 == 0 && bandera2 == 1 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^A-Z0-9]/g, '');
            } else if (bandera1 == 1 && bandera2 == 0 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^a-z0-9]/g, '');
            }
        });

        $("#txtcifrar").on("blur", function () {
            if (bandera1 == 1 && bandera2 == 1 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^0-9a-zA-Z]/g, '');
            } else if (bandera == 1 && bandera2 == 0 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^a-z]/g, '');
            } else if (bandera == 0 && bandera2 == 1 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^A-Z]/g, '');
            } else if (bandera == 0 && bandera2 == 0 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^0-9]/g, '');
            } else if (bandera == 1 && bandera2 == 1 & bandera3 == 0) {
                this.value = (this.value + '').replace(/[^a-zA-Z]/g, '');
            } else if (bandera == 0 && bandera2 == 1 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^A-Z0-9]/g, '');
            } else if (bandera == 1 && bandera2 == 0 & bandera3 == 1) {
                this.value = (this.value + '').replace(/[^a-z0-9]/g, '');
            }
        });

        $("#btnEncriptar").on("click", function () {
            if ($("#txtcifrar").val() == "") {
                $("#txtcifrar").removeClass("is-invalid");
                $("#txtcifrar").addClass("is-valid");
            } else {
                $("#txtcifrar").removeClass("is-invalid");
                $("#txtcifrar").addClass("is-valid");
                $("#btnEncriptar > span").css("display", "");
                $("#btnEncriptar > .fa-lock").css("display", "none");
                setTimeout(function () {
                    $("#txtsalidacifradatexto").val(encrypt($("#txtcifrar").val()));
                    $("#txtsalidacifradatexto").addClass("is-valid");
                    $("#divtextocifrado").show(1000);
                    $("#divdecodificar").show(1000);
                    $("#btnEncriptar > span").css("display", "none");
                    $("#btnEncriptar > .fa-lock").css("display", "");
                }, 1000);
            }
        });

        $("#btnDesencriptar").on("click", function () {
            $("#btnDesencriptar > span").css("display", "");
            $("#btnDesencriptar > .fa-unlock").css("display", "none");
            setTimeout(function () {
                $("#txtsalidadescifradatexto").val(decrypt($("#txtsalidacifradatexto").val()));
                $("#txtsalidadescifradatexto").addClass("is-valid");
                $("#divtextodescifrado").show(1000);
                $("#btnDesencriptar > span").css("display", "none");
                $("#btnDesencriptar > .fa-unlock").css("display", "");
            }, 1000);
        });

        var bandera1 = 1;
        var bandera2 = 1;
        var bandera3 = 1;
        let alfa = document.getElementById("txtAlfabeto");
        alfa.value += "abcdefghijklmnopqrstuvwxyz";
        alfabeto += "abcdefghijklmnopqrstuvwxyz";
        alfa.value += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        alfabeto += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        alfa.value += "0123456789";
        alfabeto += "0123456789";
        $("#txtAlfabeto").addClass("is-valid");
        $("#txtAlfabeto").removeClass("is-invalid");

        $("#btncontinuar").on("click", function () {
            let matrixDiv = document.getElementsByClassName("matrixDiv")[0].childNodes;
            if ($("#txtAlfabeto").val() == "") {
                $("#txtAlfabeto").addClass("is-invalid");
                $("#txtAlfabeto").removeClass("is-valid");
            } else {
                let index = 1;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        key[i][j] = parseInt(matrixDiv[index].value);
                        index += 2;
                    }
                }
                let banderaerror = 0;
                if (checkRelativelyPrime()) {
                    alertaAc("Verifique que haya ingresado correctamente la llave.", "danger", "fas fa-exclamation-triangle");
                    banderaerror = 1;
                } else {
                    banderaerror = 0;
                    alertaAc("Proceda a ingresar el texto a codificar para luego decodificarlo.", "warning", "fa fa-exclamation-circle");
                }
                if (banderaerror == 0) {
                    $("#txtAlfabeto").addClass("is-valid");
                    $("#txtAlfabeto").removeClass("is-invalid");
                    $("#divtxtclave").hide('slow');
                    $("#divtxtclave2").hide('slow');
                    $("#btncontinuar").hide('slow');
                    $("#divtextodecifrar").show(500);
                    n = alfabeto.length;
                }
            }
        });

        function checkRelativelyPrime() {
            det = parseInt(getDeterminent(key));
            let g = gcd(det, n);
            if (g == 1) {
                return true;
            } else {
                return false;
            }
        }


        function encrypt(plain) {
            let cipher = "";
            if (alfabeto.indexOf(" ") == -1) {
                plain = plain.split(" ").join("");
            }

            for (let index = 0; index < plain.length; index += 3) {
                let x = alfabeto.indexOf(plain[index]);
                let y, z;
                if (index + 1 == plain.length) {
                    y = 0;
                    z = 1;
                } else {
                    y = alfabeto.indexOf(plain[index + 1]);
                    if (index + 2 == plain.length) {
                        z = 0;
                    } else {
                        z = alfabeto.indexOf(plain[index + 2]);
                    }
                }

                let res = multiplyMatrix(key, [x, y, z]);

                for (let i = 0; i < res.length; i++) {
                    if (res[i] < 0) {
                        res[i] = getRidOfNeg(res[i], n);
                    }
                    let j = res[i] % n;
                    cipher += alfabeto[j];
                }
            }
            return cipher;
        }

        function decrypt(cipher) {
            let plain = "";
            let m = det;
            if (det < 0) {
                m = getRidOfNeg(det, n);
            }
            m = m % n;

            let modularInv = modularInverse(m, n);

            let matrixInv = inverseMatrix(key);

            for (let index = 0; index < cipher.length; index += 3) {
                let x = alfabeto.indexOf(cipher[index]);
                let y = alfabeto.indexOf(cipher[index + 1]);
                let z = alfabeto.indexOf(cipher[index + 2]);

                let res = multiplyMatrix(matrixInv, [x, y, z]);

                for (let i = 0; i < res.length; i++) {
                    res[i] *= modularInv;

                    if (res[i] < 0) {
                        res[i] = getRidOfNeg(res[i], n);
                    }

                    let j = res[i] % n;

                    plain += alfabeto[j];
                }

            }
            return plain;
        }
    </script>
</body>

</html>